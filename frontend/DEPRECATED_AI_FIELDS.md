# Deprecated AI Fields - Do Not Use

This document outlines AI-generated fields that are **deprecated** and should **NOT** be used for business logic. These fields were initially generated by Gemini AI but are unreliable for accurate priority and timing calculations.

## ❌ **Deprecated Fields in `email_threads` Table**

### **Priority & Action Fields (DEPRECATED)**
These fields are AI-generated guesses and do NOT reflect actual email timing or user actions:

```sql
-- DEPRECATED: AI-generated priority (inaccurate)
priority_level TEXT CHECK (priority_level IN ('READ_NOW', 'REPLY_NOW', 'NORMAL', 'LOW'))

-- DEPRECATED: AI-generated action status (unreliable)  
next_action_status TEXT CHECK (next_action_status IN ('read', 'reply', 'other'))

-- DEPRECATED: AI-generated action description (vague)
next_action_description TEXT

-- DEPRECATED: AI-generated activity summary (inconsistent)
last_action_summary TEXT

-- DEPRECATED: AI reasoning for priority (not used)
auto_priority_reasoning TEXT
```

### **Processing Status Fields (DEPRECATED)**
These track AI processing status but aren't needed for business logic:

```sql
-- DEPRECATED: Whether Gemini processed this thread
llm_processed BOOLEAN DEFAULT FALSE

-- DEPRECATED: When Gemini processed this thread  
llm_processed_at TIMESTAMP WITH TIME ZONE
```

## ✅ **Use These Fields Instead**

### **For Accurate Timing**
Use actual email timestamps instead of AI summaries:

```sql
-- ✅ CORRECT: When first email was sent/received
first_message_date TIMESTAMP WITH TIME ZONE NOT NULL

-- ✅ CORRECT: When last email was sent/received  
last_message_date TIMESTAMP WITH TIME ZONE NOT NULL

-- ✅ CORRECT: Total number of messages in thread
message_count INTEGER NOT NULL DEFAULT 0
```

### **For Message Direction Detection**
Query the `email_messages` table directly:

```sql
-- ✅ CORRECT: Check who sent the last message
SELECT is_from_user, received_date, sender_email 
FROM email_messages 
WHERE thread_id = ? 
ORDER BY received_date DESC 
LIMIT 1
```

### **For Thread Status**
Use the actual thread status instead of AI action fields:

```sql
-- ✅ CORRECT: Actual thread status
status TEXT CHECK (status IN ('new', 'in_progress', 'responded', 'closed'))
```

## 🔧 **Current Implementation**

### **Priority Calculation (CORRECT)**
Located in `/frontend/src/app/sponsorships/page.tsx`:

```typescript
// ✅ Uses actual message timing and direction
const getNextActionInfo = (sponsor) => {
  const { actualLastMessageDate, lastMessageFromUser } = sponsor;
  const daysSinceLastMessage = (now - lastMessageDate) / (1000 * 60 * 60 * 24);
  
  if (userRepliedLast) {
    return daysSinceLastMessage <= 2 ? 'Awaiting Response' : 'Bump';
  } else {
    return daysSinceLastMessage <= 2 ? 'Read/Respond' : 'READ/RESPOND IMMEDIATELY';
  }
}
```

### **API Response Structure (CORRECT)**
Located in `/frontend/src/app/api/sponsors/route.ts`:

```typescript
// ✅ Actual email data (use these)
firstMessageDate: thread.first_message_date,
lastMessageDate: thread.last_message_date, 
actualLastMessageDate: thread.actualLastMessageDate,
lastMessageFromUser: thread.lastMessageFromUser,

// ❌ Deprecated AI fields (DO NOT USE)
priority: thread.priority_level, // DEPRECATED
lastActionSummary: thread.last_action_summary, // DEPRECATED
nextActionStatus: thread.next_action_status, // DEPRECATED
nextActionDescription: thread.next_action_description // DEPRECATED
```

## 🚨 **Why These Fields Are Deprecated**

### **Inaccurate Timing**
- AI used `updated_at` (database modification time) instead of `last_message_date` (actual email time)
- AI couldn't accurately determine time since last user response

### **Unreliable Direction Detection**  
- AI guessed message direction from email content
- AI summaries were inconsistent and contained false positives
- Real `is_from_user` field from `email_messages` is definitive

### **False Urgency**
- AI marked threads as `REPLY_NOW` even after recent user responses
- AI couldn't account for actual conversation flow and timing context

## 📋 **Migration Notes**

**If you see these patterns in code, replace them:**

```typescript
// ❌ OLD (using AI fields)
const hasReplied = lastActionSummary?.includes('replied')
const daysSince = (now - updatedAt) / (1000 * 60 * 60 * 24)

// ✅ NEW (using actual data)  
const hasReplied = lastMessageFromUser
const daysSince = (now - actualLastMessageDate) / (1000 * 60 * 60 * 24)
```

**Database queries to avoid:**
```sql
-- ❌ DON'T: Rely on AI fields for priority
WHERE priority_level = 'REPLY_NOW'

-- ✅ DO: Use actual message data
WHERE last_message_date < NOW() - INTERVAL '2 days'  
AND (SELECT is_from_user FROM email_messages WHERE thread_id = email_threads.id ORDER BY received_date DESC LIMIT 1) = false
```

## 🎯 **Summary**

**Use actual email data, not AI interpretations.** The deprecated AI fields were an early attempt at automation but proved unreliable for business logic. The current system uses definitive email timing and direction data for accurate priority calculations.